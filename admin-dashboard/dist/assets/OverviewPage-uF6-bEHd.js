var C=Object.defineProperty;var _=(r,s,a)=>s in r?C(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var w=(r,s,a)=>_(r,typeof s!="symbol"?s+"":s,a);import{j as e,c as f,a as A,b as E}from"./index-DSs7LwEb.js";import{r as d}from"./react-BIF_SMrh.js";import{H as P}from"./Header-VXjz6aHN.js";const g=({title:r,value:s,icon:a,change:o,changeType:t="neutral",color:i="blue"})=>{const l={blue:"bg-blue-50 border-blue-200",green:"bg-green-50 border-green-200",orange:"bg-orange-50 border-orange-200",purple:"bg-purple-50 border-purple-200"},c={positive:"text-green-600",negative:"text-red-600",neutral:"text-gray-600"};return e.jsx("div",{className:f("rounded-lg border-2 p-6",l[i]),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:r}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:s}),o&&e.jsx("p",{className:f("mt-2 text-sm font-medium",c[t]),children:o})]}),e.jsx("div",{className:"text-4xl",children:a})]})})},k=({variant:r="primary",size:s="md",icon:a,loading:o=!1,children:t,className:i,disabled:l,...c})=>{const m="inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",u={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-gray-500"},x={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"};return e.jsxs("button",{className:f(m,u[r],x[s],i),disabled:l||o,...c,children:[o&&e.jsxs("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a&&!o&&e.jsx("span",{className:"mr-2",children:a}),t]})};class q{constructor(){w(this,"baseUrl");this.baseUrl=A.api.endpoint}async request(s,a={}){try{const o=E.getIdToken(),t=new Headers(a.headers);o&&t.set("Authorization",`Bearer ${o}`),t.set("Content-Type","application/json");const i=await fetch(`${this.baseUrl}${s}`,{...a,headers:t});let l=await i.json();if(console.log("Raw API response:",l),typeof l.body=="string"&&(console.log("Parsing body string..."),l=JSON.parse(l.body),console.log("Parsed data:",l)),!i.ok)throw new Error(l.error||l.message||"API request failed");const c={success:!0,...l};return console.log("Final result:",c),c}catch(o){return console.error("API request error:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}async get(s){return this.request(s,{method:"GET"})}async post(s,a){return this.request(s,{method:"POST",body:a?JSON.stringify(a):void 0})}async put(s,a){return this.request(s,{method:"PUT",body:a?JSON.stringify(a):void 0})}async delete(s){return this.request(s,{method:"DELETE"})}}const b=new q;async function T(){const r=await b.post("/admin/execute-sql",{action:"get_overview_stats"});if(!r.success)throw new Error(r.error||"Failed to get overview stats");return r}async function R(r){const s=await b.post("/admin/execute-sql",{action:"get_appointments",...r});if(!s.success)throw new Error(s.error||"Failed to get appointments");return s}async function D(r){const s=await b.post("/admin/execute-sql",{action:"get_programs",...r});if(!s.success)throw new Error(s.error||"Failed to get programs");return s}const S=r=>{if(!r)return"N/A";try{const s=new Date(r);return isNaN(s.getTime())?r.split("T")[0]||r:s.toLocaleDateString("vi-VN")}catch{return r}},H=()=>{var y,j,N;const[r,s]=d.useState(!1),[a,o]=d.useState(null),[t,i]=d.useState(null),[l,c]=d.useState([]),[m,u]=d.useState([]),x=async()=>{s(!0),o(null);try{const[n,p,v]=await Promise.all([T(),R({limit:5}),D({limit:5})]);console.log("Stats response:",n),console.log("Appointments response:",p),console.log("Programs response:",v),i(n),c(p.appointments||[]),u(v.programs||[])}catch(n){o(n instanceof Error?n.message:"Failed to fetch data"),console.error("Error fetching overview data:",n)}finally{s(!1)}};d.useEffect(()=>{x()},[]);const h=n=>{switch(n==null?void 0:n.toLowerCase()){case"confirmed":case"completed":case"active":return"bg-green-100 text-green-800";case"pending":case"upcoming":return"bg-yellow-100 text-yellow-800";case"cancelled":case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(P,{title:"Overview",subtitle:"Welcome back! Here's what's happening with your career counseling service.",actions:e.jsx(k,{onClick:x,loading:r,icon:"ðŸ”„",children:"Refresh"})}),e.jsxs("div",{className:"p-6",children:[a&&e.jsxs("div",{className:"mb-6 rounded-lg bg-red-50 p-4 text-red-700",children:[e.jsx("strong",{children:"Error:"})," ",a]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(g,{title:"Total Customers",value:((y=t==null?void 0:t.total_customers)==null?void 0:y.toString())||"0",icon:"ðŸ‘¥",color:"blue"}),e.jsx(g,{title:"Consultants",value:((j=t==null?void 0:t.total_consultants)==null?void 0:j.toString())||"0",icon:"ðŸ‘¨â€ðŸ’¼",color:"green"}),e.jsx(g,{title:"Appointments",value:((N=t==null?void 0:t.total_appointments)==null?void 0:N.toString())||"0",icon:"ðŸ“…",color:"orange"}),e.jsx(g,{title:"Avg Rating",value:t!=null&&t.average_rating?`${t.average_rating.toFixed(1)} â­`:"N/A",icon:"â­",change:t!=null&&t.total_feedbacks?`${t.total_feedbacks} feedbacks`:void 0,color:"purple"})]}),(t==null?void 0:t.appointments_by_status)&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Appointment Status Distribution"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:Object.entries(t.appointments_by_status).map(([n,p])=>e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("div",{className:`inline-block rounded-full px-3 py-1 text-sm font-medium ${h(n)}`,children:n}),e.jsx("div",{className:"mt-2 text-2xl font-bold",children:p})]},n))})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Recent Appointments"}),l.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Customer"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Consultant"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:l.map(n=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:n.customer_name}),e.jsx("td",{className:"px-3 py-2",children:n.consultant_name}),e.jsx("td",{className:"px-3 py-2",children:S(n.date)}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-block rounded-full px-2 py-1 text-xs ${h(n.status)}`,children:n.status})})]},n.appointmentid))})]})}):e.jsx("div",{className:"flex h-32 items-center justify-center text-gray-500",children:r?"Loading...":"No appointments found"})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold",children:"Community Programs"}),m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Program"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Participants"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:m.map(n=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2 font-medium",children:n.programname}),e.jsx("td",{className:"px-3 py-2 text-xs",children:S(n.date)}),e.jsx("td",{className:"px-3 py-2 text-center",children:n.participant_count}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-block rounded-full px-2 py-1 text-xs ${h(n.status)}`,children:n.status})})]},n.programid))})]})}):e.jsx("div",{className:"flex h-32 items-center justify-center text-gray-500",children:r?"Loading...":"No programs found"})]})]})]})]})};export{H as default};
//# sourceMappingURL=OverviewPage-uF6-bEHd.js.map
